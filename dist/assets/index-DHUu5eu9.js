import{r as w,g as k,a as S}from"./react-D3F3s8fL.js";import{i as C,g as _,G as E,a as O,o as P,s as L,b as I,q,c as D,d as R,e as F,f as J,h as T}from"./firebase-DwTWrdd1.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();var b={exports:{}},x={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j;function U(){if(j)return x;j=1;var e=w(),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function n(u,c,g){var l,p={},d=null,h=null;g!==void 0&&(d=""+g),c.key!==void 0&&(d=""+c.key),c.ref!==void 0&&(h=c.ref);for(l in c)a.call(c,l)&&!i.hasOwnProperty(l)&&(p[l]=c[l]);if(u&&u.defaultProps)for(l in c=u.defaultProps,c)p[l]===void 0&&(p[l]=c[l]);return{$$typeof:r,type:u,key:d,ref:h,props:p,_owner:o.current}}return x.Fragment=s,x.jsx=n,x.jsxs=n,x}var N;function $(){return N||(N=1,b.exports=U()),b.exports}var t=$(),m=w();const G=k(m);var f={},v;function M(){if(v)return f;v=1;var e=S();return f.createRoot=e.createRoot,f.hydrateRoot=e.hydrateRoot,f}var W=M();const K=k(W),z={apiKey:"AIzaSyATBmKAC9Zmylxb7bOAgHycdP8I7e7iJII",authDomain:"book-exchange-network.firebaseapp.com",projectId:"book-exchange-network",storageBucket:"book-exchange-network.firebasestorage.app",messagingSenderId:"1067589088419",appId:"1:1067589088419:web:a6cf3cc57f2c08404cbb16"},B=C(z),y=_(B),H=new E,A=O(B);function Y(){const[e,r]=m.useState(null),[s,a]=m.useState(!0);return m.useEffect(()=>{const n=P(y,u=>{r(u),a(!1)});return()=>n()},[]),{user:e,loadingAuth:s,login:async()=>{try{await I(y,H)}catch(n){console.error("Login error:",n),alert("Login failed: "+(n.message||n))}},logout:async()=>{try{await L(y)}catch(n){console.error("Sign out error:",n),alert("Sign out failed: "+(n.message||n))}}}}function Z({user:e,onLogout:r}){return t.jsxs("header",{className:"flex items-center justify-between max-w-6xl mx-auto mb-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white mb-1",children:"ðŸ“š Book Exchange Network"}),t.jsx("p",{className:"text-sm text-gray-400",children:"Campus-only listings â€¢ Be courteous when contacting owners"})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"text-right",children:t.jsx("div",{className:"text-sm font-medium  text-gray-100 px-2 py-1 rounded",children:e.displayName||e.email})}),t.jsx("button",{onClick:r,className:"bg-green-600 text-white px-3 py-2 rounded hover:bg-green-900",children:"Logout"})]})]})}function Q({form:e,setForm:r,onSubmit:s}){return t.jsxs("section",{className:"bg-gray-500 shadow rounded-lg p-6 mb-8",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4 ",children:"âž• Add a Book"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx("input",{className:"border p-2 rounded",placeholder:"Book Title *",value:e.title,onChange:a=>r({...e,title:a.target.value})}),t.jsx("input",{className:"border p-2 rounded",placeholder:"Subject",value:e.subject,onChange:a=>r({...e,subject:a.target.value})}),t.jsx("input",{className:"border p-2 rounded",placeholder:"Semester",value:e.semester,onChange:a=>r({...e,semester:a.target.value})}),t.jsx("input",{className:"border p-2 rounded",placeholder:"Price (or Free)",value:e.price,onChange:a=>r({...e,price:a.target.value})}),t.jsxs("div",{className:"flex items-center md:col-span-2",children:[t.jsx("span",{className:"bg-gray-200 px-3 py-2 rounded-l text-gray-700",children:"+91"}),t.jsx("input",{className:"border p-2 rounded-r flex-1",placeholder:"WhatsApp",value:e.phone,onChange:a=>r({...e,phone:a.target.value.replace(/\D/g,"")}),inputMode:"numeric"})]})]}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:s,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Add Book"})})]})}function V({book:e}){const r=e.phone||"Not provided",s=e.phone?e.phone.replace(/\D/g,""):null;return`${encodeURIComponent(e.ownerEmail||"")}${encodeURIComponent("Book request: "+(e.title||""))}`,t.jsxs("div",{className:"bg-gray-600 p-4 rounded shadow-inner shadow-gray-400 border-gray-900 border",children:[t.jsxs("h3",{className:"font-bold text-lg mb-1",children:["Book: ",e.title]}),t.jsxs("p",{className:"text-gray-200 text-sm",children:["ðŸ“˜Subject: ",e.subject||"â€”"]}),t.jsxs("p",{className:"text-gray-200 text-sm",children:["ðŸŽ“Semester: ",e.semester||"â€”"]}),t.jsxs("p",{className:"text-green-500 font-semibold mt-2",children:["ðŸ’°Price: ",e.price||"Free"]}),t.jsxs("div",{className:"mt-3 text-sm text-gray-200",children:[t.jsxs("p",{children:["ðŸ“ž ",r]}),t.jsxs("p",{className:"text-gray-200",children:["Owner: ",e.ownerName||e.ownerEmail||"â€”"]})]}),t.jsx("div",{className:"mt-3 flex gap-3",children:s&&s.length>=10&&t.jsx("a",{href:`https://wa.me/${s}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 underline",children:"WhatsApp"})})]})}function X({books:e,loading:r}){return t.jsxs("section",{className:"mb-12 bg-slate-800 shadow rounded-lg p-2",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4 text-cyan-200",children:"ðŸ“– Available Books"}),r?t.jsx("p",{className:"text-gray-600",children:"Loading books..."}):e.length===0?t.jsx("p",{className:"text-gray-600",children:"No books available yet â€” be the first to add one!"}):t.jsx("div",{className:"grid gap-6 grid-cols-2 md:grid-cols-2 lg:grid-cols-3 ",children:e.map(s=>t.jsx(V,{book:s},s.id))})]})}async function ee(){const e=q(R(A,"books"),D("createdAt","desc"));return(await F(e)).docs.map(s=>({id:s.id,...s.data()}))}function te(e,r){const s=(e.phone||"").replace(/\D/g,"");if(s.length<10)throw new Error("Please enter a valid 10-digit phone number (without +91).");const o="+91"+s.slice(-10);return{title:e.title,subject:e.subject||"",semester:e.semester||"",price:e.price||"Free",phone:o,ownerEmail:r?.email||"",ownerName:r?.displayName||"",createdAt:J()}}async function re(e){await T(R(A,"books"),e)}function se(){const{user:e,loadingAuth:r,login:s,logout:a}=Y(),[o,i]=m.useState(!1),[n,u]=m.useState([]),[c,g]=m.useState({title:"",subject:"",semester:"",price:"",phone:""});m.useEffect(()=>{e?l():u([])},[e]);const l=async()=>{i(!0);try{const d=await ee();u(d)}catch(d){console.error("Error loading books:",d),alert("Failed to load books. Check console for details.")}finally{i(!1)}},p=async()=>{if(!c.title||!c.phone){alert("Please enter at least a book title and a phone number.");return}let d;try{d=te(c,e)}catch(h){alert(h.message);return}try{await re(d),g({title:"",subject:"",semester:"",price:"",phone:""}),await l()}catch(h){console.error("Error adding book:",h),alert("Failed to add book. Check console for details.")}};return r?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"loader mb-2"}),t.jsx("p",{className:"text-gray-600",children:"Checking authentication..."})]})}):e?t.jsxs("div",{className:"min-h-screen bg-black p-3",children:[t.jsx(Z,{user:e,onLogout:a}),t.jsxs("main",{className:"max-w-6xl mx-auto",children:[t.jsx(Q,{form:c,setForm:g,onSubmit:p}),t.jsx(X,{books:n,loading:o})]})]}):t.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-6",children:t.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-md text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-black-900 mb-4",children:"ðŸ“š Book Exchange Network"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Sign in with your Google account to start listing and browsing books."}),t.jsx("button",{onClick:s,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Sign in with Google"})]})})}K.createRoot(document.getElementById("root")).render(t.jsx(G.StrictMode,{children:t.jsx(se,{})}));
