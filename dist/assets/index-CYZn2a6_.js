import{r as E,g as A,a as P}from"./react-D3F3s8fL.js";import{i as I,g as q,G as L,a as D,o as F,q as J,c as k,b as T,d as U,s as $,e as G,f as M,h as W}from"./firebase-D74iQiv5.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))p(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&p(i)}).observe(document,{childList:!0,subtree:!0});function x(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function p(s){if(s.ep)return;s.ep=!0;const o=x(s);fetch(s.href,o)}})();var v={exports:{}},b={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R;function K(){if(R)return b;R=1;var a=E(),m=Symbol.for("react.element"),x=Symbol.for("react.fragment"),p=Object.prototype.hasOwnProperty,s=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(c,r,l){var n,h={},g=null,y=null;l!==void 0&&(g=""+l),r.key!==void 0&&(g=""+r.key),r.ref!==void 0&&(y=r.ref);for(n in r)p.call(r,n)&&!o.hasOwnProperty(n)&&(h[n]=r[n]);if(c&&c.defaultProps)for(n in r=c.defaultProps,r)h[n]===void 0&&(h[n]=r[n]);return{$$typeof:m,type:c,key:g,ref:y,props:h,_owner:s.current}}return b.Fragment=x,b.jsx=i,b.jsxs=i,b}var S;function z(){return S||(S=1,v.exports=K()),v.exports}var e=z(),u=E();const H=A(u);var N={},_;function Y(){if(_)return N;_=1;var a=P();return N.createRoot=a.createRoot,N.hydrateRoot=a.hydrateRoot,N}var Z=Y();const Q=A(Z),V={apiKey:"AIzaSyATBmKAC9Zmylxb7bOAgHycdP8I7e7iJII",authDomain:"book-exchange-network.firebaseapp.com",projectId:"book-exchange-network",storageBucket:"book-exchange-network.firebasestorage.app",messagingSenderId:"1067589088419",appId:"1:1067589088419:web:a6cf3cc57f2c08404cbb16"},B=I(V),w=q(B),X=new L,C=D(B);function ee(){const[a,m]=u.useState(null),[x,p]=u.useState(!0),[s,o]=u.useState(!1),[i,c]=u.useState([]),[r,l]=u.useState({title:"",subject:"",semester:"",price:"",phone:""});u.useEffect(()=>{const t=F(w,f=>{m(f),p(!1)});return()=>t()},[]),u.useEffect(()=>{a?g():c([])},[a]);const n=async()=>{try{await $(w,X)}catch(t){console.error("Login error:",t),alert("Login failed: "+(t.message||t))}},h=async()=>{try{await G(w),c([])}catch(t){console.error("Sign out error:",t),alert("Sign out failed: "+(t.message||t))}},g=async()=>{o(!0);try{const t=J(k(C,"books"),T("createdAt","desc")),d=(await U(t)).docs.map(j=>({id:j.id,...j.data()}));console.log("Books loaded:",d),c(d)}catch(t){console.error("Error loading books:",t),alert("Failed to load books. Check console for details.")}finally{o(!1)}},y=async()=>{if(!r.title||!r.phone){alert("Please enter at least a book title and a phone number.");return}const t=r.phone.replace(/\D/g,"");if(t.length<10){alert("Please enter a valid 10-digit phone number (without +91).");return}const d="+91"+t.slice(-10),j={title:r.title,subject:r.subject||"",semester:r.semester||"",price:r.price||"Free",phone:d,ownerEmail:a?.email||"",ownerName:a?.displayName||"",createdAt:W()};try{await M(k(C,"books"),j),l({title:"",subject:"",semester:"",price:"",phone:""}),await g()}catch(O){console.error("Error adding book:",O),alert("Failed to add book. Check console for details.")}};return x?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"loader mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Checking authentication..."})]})}):a?e.jsxs("div",{className:"min-h-screen bg-black p-3",children:[e.jsxs("header",{className:"flex items-center justify-between max-w-6xl mx-auto mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-1",children:"ðŸ“š Book Exchange Network"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Campus-only listings â€¢ Be courteous when contacting owners"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Signed in as"}),e.jsx("div",{className:"text-sm font-medium  text-gray-100 px-2 py-1 rounded",children:a.displayName||a.email})]}),e.jsx("button",{onClick:h,className:"bg-green-600 text-white px-3 py-2 rounded hover:bg-green-900",children:"Logout"})]})]}),e.jsxs("main",{className:"max-w-6xl mx-auto",children:[e.jsxs("section",{className:"bg-gray-500 shadow rounded-lg p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 ",children:"âž• Add a Book"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{className:"border p-2 rounded",placeholder:"Book Title *",value:r.title,onChange:t=>l({...r,title:t.target.value})}),e.jsx("input",{className:"border p-2 rounded",placeholder:"Subject",value:r.subject,onChange:t=>l({...r,subject:t.target.value})}),e.jsx("input",{className:"border p-2 rounded",placeholder:"Semester",value:r.semester,onChange:t=>l({...r,semester:t.target.value})}),e.jsx("input",{className:"border p-2 rounded",placeholder:"Price (or Free)",value:r.price,onChange:t=>l({...r,price:t.target.value})}),e.jsxs("div",{className:"flex items-center md:col-span-2",children:[e.jsx("span",{className:"bg-gray-200 px-3 py-2 rounded-l text-gray-700",children:"+91"}),e.jsx("input",{className:"border p-2 rounded-r flex-1",placeholder:"WhatsApp)",value:r.phone,onChange:t=>l({...r,phone:t.target.value.replace(/\D/g,"")}),inputMode:"numeric"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:y,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Add Book"})})]}),e.jsxs("section",{className:"mb-12 bg-slate-800 shadow rounded-lg p-2",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-cyan-200",children:"ðŸ“– Available Books"}),s?e.jsx("p",{className:"text-gray-600",children:"Loading books..."}):i.length===0?e.jsx("p",{className:"text-gray-600",children:"No books available yet â€” be the first to add one!"}):e.jsx("div",{className:"grid gap-6 grid-cols-2 md:grid-cols-2 lg:grid-cols-3 ",children:i.map(t=>{const f=t.phone||"Not provided",d=t.phone?t.phone.replace(/\D/g,""):null;return`${encodeURIComponent(t.ownerEmail||"")}${encodeURIComponent("Book request: "+(t.title||""))}`,e.jsxs("div",{className:"bg-gray-600 p-4 rounded shadow-inner shadow-gray-400 border-gray-900 border",children:[e.jsxs("h3",{className:"font-bold text-lg mb-1",children:["Book: ",t.title]}),e.jsxs("p",{className:"text-gray-200 text-sm",children:["ðŸ“˜Subject:  ",t.subject||"â€”"]}),e.jsxs("p",{className:"text-gray-200 text-sm",children:["ðŸŽ“Semester: ",t.semester||"â€”"]}),e.jsxs("p",{className:"text-green-500 font-semibold mt-2",children:["ðŸ’°Price: ",t.price||"Free"]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-200",children:[e.jsxs("p",{children:["ðŸ“ž ",f]}),e.jsxs("p",{className:"text-gray-200",children:["Owner: ",t.ownerName||t.ownerEmail||"â€”"]})]}),e.jsx("div",{className:"mt-3 flex gap-3",children:d&&d.length>=10&&e.jsx("a",{href:`https://wa.me/${d}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 underline",children:"WhatsApp"})})]},t.id)})})]})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-md text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-black-900 mb-4",children:"ðŸ“š Book Exchange Network"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Sign in with your Google account to start listing and browsing books."}),e.jsx("button",{onClick:n,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Sign in with Google"})]})})}Q.createRoot(document.getElementById("root")).render(e.jsx(H.StrictMode,{children:e.jsx(ee,{})}));
